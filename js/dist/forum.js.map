{"version":3,"sources":["webpack://@fof/upload/webpack/bootstrap","webpack://@fof/upload/./forum.js","webpack://@fof/upload/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/upload/./src/forum/addUploadButton.js","webpack://@fof/upload/./src/forum/components/DragAndDrop.js","webpack://@fof/upload/./src/forum/components/PasteClipboard.js","webpack://@fof/upload/./src/forum/components/UploadButton.js","webpack://@fof/upload/./src/forum/downloadButtonInteraction.js","webpack://@fof/upload/./src/forum/index.js","webpack://@fof/upload/external \"flarum.core.compat['Component']\"","webpack://@fof/upload/external \"flarum.core.compat['app']\"","webpack://@fof/upload/external \"flarum.core.compat['components/EditPostComposer']\"","webpack://@fof/upload/external \"flarum.core.compat['components/LoadingIndicator']\"","webpack://@fof/upload/external \"flarum.core.compat['components/Post']\"","webpack://@fof/upload/external \"flarum.core.compat['components/ReplyComposer']\"","webpack://@fof/upload/external \"flarum.core.compat['components/TextEditor']\"","webpack://@fof/upload/external \"flarum.core.compat['extend']\"","webpack://@fof/upload/external \"flarum.core.compat['helpers/icon']\"","webpack://@fof/upload/external \"flarum.core.compat['utils/Stream']\""],"names":["extend","TextEditor","prototype","items","app","forum","attribute","fofUploadButton","UploadButton","component","textAreaObj","add","DragAndDrop","uploadButton","composerElement","handlers","supportsFileDragging","addEventListener","bind","out","dropping","isDropping","over","div","document","createElement","window","unload","removeEventListener","isNotFile","event","dataTransfer","i","length","kind","preventDefault","classList","remove","uploadFiles","files","then","PasteClipboard","textAreaElement","paste","e","clipboardData","type","indexOf","push","getAsFile","oninit","vnode","attrs","uploading","Stream","view","buttonText","translator","trans","m","className","LoadingIndicator","size","icon","multiple","onchange","process","$","prop","redraw","data","FormData","append","request","method","url","serialize","raw","success","failure","message","alert","response","forEach","bbcode","insertAtCursor","composer","ReplyComposer","route","set","discussion","props","EditPostComposer","post","setTimeout","reset","Component","Post","isInitialized","unbind","on","stopPropagation","currentTarget","dataset","fofUploadDownloadUuid","id","session","csrfToken","open","initializers","addUploadButton","downloadButtonInteraction"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","export * from './src/forum';\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import app from 'flarum/app';\nimport {extend} from 'flarum/extend';\nimport TextEditor from 'flarum/components/TextEditor';\nimport UploadButton from './components/UploadButton';\nimport DragAndDrop from './components/DragAndDrop';\nimport PasteClipboard from './components/PasteClipboard';\n\nexport default function () {\n    // extend(TextEditor.prototype, 'oninit', function () {\n    //     if (!app.forum.attribute('fof-upload.canUpload')) return;\n    // });\n\n    extend(TextEditor.prototype, 'controlItems', function (items) {\n        if (!app.forum.attribute('fof-upload.canUpload')) return;\n\n        this.fofUploadButton = UploadButton.component({\n            textAreaObj: this\n        });\n\n        items.add('fof-upload', this.fofUploadButton);\n    });\n\n    // extend(TextEditor.prototype, 'config', function (output, isInitialized, context) {\n    //     if (isInitialized) return;\n    //\n    //     if (!app.forum.attribute('fof-upload.canUpload')) return;\n    //\n    //     const dragAndDrop = new DragAndDrop(this.fofUploadButton, this.$().parents('.Composer')[0]);\n    //\n    //     const unloadHandler = () => {\n    //         dragAndDrop.unload();\n    //     };\n    //\n    //     if (context.onunload) {\n    //         extend(context, 'onunload', unloadHandler);\n    //     } else {\n    //         context.onunload = unloadHandler;\n    //     }\n    // });\n    //\n    // extend(TextEditor.prototype, 'configTextarea', function (output, element, isInitialized) {\n    //     if (isInitialized) return;\n    //\n    //     if (!app.forum.attribute('fof-upload.canUpload')) return;\n    //\n    //     new PasteClipboard(this.fofUploadButton, element);\n    // });\n}\n","export default class DragAndDrop {\n    constructor(uploadButton, composerElement) {\n        this.uploadButton = uploadButton;\n        this.composerElement = composerElement;\n\n        // Keep references to the bound methods so we can remove the event listeners later\n        this.handlers = {};\n\n        if (!this.supportsFileDragging()) {\n            return;\n        }\n\n        this.composerElement.addEventListener('dragover', this.handlers.in = this.in.bind(this));\n\n        this.composerElement.addEventListener('dragleave', this.handlers.out = this.out.bind(this));\n        this.composerElement.addEventListener('dragend', this.handlers.out);\n\n        this.composerElement.addEventListener('drop', this.handlers.dropping = this.dropping.bind(this));\n\n        this.isDropping = this.over = false;\n    }\n\n    supportsFileDragging() {\n        // Based on https://css-tricks.com/drag-and-drop-file-uploading/\n        const div = document.createElement('div');\n\n        return (('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;\n    }\n\n    unload() {\n        // If the handlers were not set (drag and drop not supported), we skip removing them\n        if (!this.handlers.in) {\n            return;\n        }\n\n        this.composerElement.removeEventListener('dragover', this.handlers.in);\n\n        this.composerElement.removeEventListener('dragleave', this.handlers.out);\n        this.composerElement.removeEventListener('dragend', this.handlers.out);\n\n        this.composerElement.removeEventListener('drop', this.handlers.dropping);\n    }\n\n    isNotFile(event) {\n        // Checking event.dataTransfer.files.length does not work on dragover event, it's always zero\n        // So we use the dataTransfer.items property to check whether any file is being dragged\n        if (event.dataTransfer.items) {\n            for (let i = 0; i < event.dataTransfer.items.length; i++) {\n                if (event.dataTransfer.items[i].kind !== 'file') {\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    }\n\n    in(event) {\n        if (this.isNotFile(event)) {\n            return;\n        }\n\n        event.preventDefault();\n\n        if (!this.over) {\n            this.composerElement.classList.add('fof-upload-dragging');\n            this.over = true;\n        }\n    }\n\n    out(event) {\n        if (this.isNotFile(event)) {\n            return;\n        }\n\n        event.preventDefault();\n\n        if (this.over) {\n            this.composerElement.classList.remove('fof-upload-dragging');\n            this.over = false;\n        }\n    }\n\n    dropping(event) {\n        if (this.isNotFile(event)) {\n            return;\n        }\n\n        event.preventDefault();\n\n        if (!this.isDropping) {\n            this.isDropping = true;\n            this.composerElement.classList.add('fof-upload-dropping');\n\n            this.uploadButton.uploadFiles(event.dataTransfer.files)\n                .then(() => {\n                    this.composerElement.classList.remove('fof-upload-dropping');\n                    this.isDropping = false;\n                });\n        }\n    }\n}\n","export default class PasteClipboard {\n    constructor(uploadButton, textAreaElement) {\n        this.uploadButton = uploadButton;\n\n        // We don't need to remove the events listeners, because they are bound to the textarea when it's created,\n        // and need to stay as long as the textarea exists in the DOM\n        textAreaElement.addEventListener('paste', this.paste.bind(this));\n    }\n\n    paste(e) {\n        if (e.clipboardData && e.clipboardData.items) {\n            const items = e.clipboardData.items;\n\n            const files = [];\n\n            for (let i = 0; i < items.length; i++) {\n                if (items[i].type.indexOf('image') !== -1) {\n                    files.push(items[i].getAsFile());\n                }\n            }\n\n            if (files.length > 0) {\n                e.preventDefault();\n\n                this.uploadButton.uploadFiles(files);\n            }\n        }\n    }\n}\n","import app from 'flarum/app';\nimport Component from 'flarum/Component';\nimport icon from 'flarum/helpers/icon';\nimport LoadingIndicator from 'flarum/components/LoadingIndicator';\nimport ReplyComposer from 'flarum/components/ReplyComposer';\nimport EditPostComposer from 'flarum/components/EditPostComposer';\nimport Stream from 'flarum/utils/Stream'\n\nexport default class UploadButton extends Component {\n    oninit(vnode) {\n        super.oninit();\n        // the service type handling uploads\n        this.textAreaObj = vnode.attrs.textAreaObj;\n        // initial state of the button\n        this.uploading = Stream(false);\n    }\n\n    view() {\n        const buttonText = this.uploading() ? app.translator.trans('fof-upload.forum.states.loading') : app.translator.trans('fof-upload.forum.buttons.attach');\n\n        return m('.Button.hasIcon.fof-upload-button.Button--icon', {\n            className: this.uploading() ? 'uploading' : '',\n        }, [\n            this.uploading() ? LoadingIndicator.component({\n                size: 'tiny',\n                className: 'LoadingIndicator--inline Button-icon',\n            }) : icon('fas fa-file-upload', {className: 'Button-icon'}),\n            m('span.Button-label', buttonText),\n            m('form', [\n                m('input', {\n                    type: 'file',\n                    multiple: true,\n                    onchange: this.process.bind(this),\n                }),\n            ]),\n        ]);\n    }\n\n    /**\n     * Process the upload event.\n     *\n     * @param e\n     */\n    process(e) {\n        // get the file from the input field\n        const files = this.$('input').prop('files');\n\n        this.uploadFiles(files);\n    }\n\n    uploadFiles(files) {\n        this.uploading(true);\n        m.redraw(); // Forcing a redraw so that the button also updates if uploadFiles() is called from DragAndDrop or PasteClipboard\n\n        const data = new FormData;\n\n        for (let i = 0; i < files.length; i++) {\n            data.append('files[]', files[i]);\n        }\n\n        // send a POST request to the api\n        return app.request({\n            method: 'POST',\n            url: app.forum.attribute('apiUrl') + '/fof/upload',\n            // prevent JSON.stringify'ing the form data in the XHR call\n            serialize: raw => raw,\n            data\n        }).then(\n            this.success.bind(this),\n            this.failure.bind(this)\n        );\n    }\n\n    /**\n     * Handles errors.\n     *\n     * @param message\n     */\n    failure(message) {\n        alert(app.translator.trans('fof-upload.forum.states.error'));\n    }\n\n    /**\n     * Appends the file's link to the body of the composer.\n     */\n    success(response) {\n        response.forEach((bbcode) => {\n            this.textAreaObj.insertAtCursor(bbcode + '\\n');\n        });\n\n        // Scroll the preview into view\n        // We don't call this.textAreaObj.props.preview() because that would close the composer on mobile\n        // Instead we just directly perform the same scrolling and skip the part about minimizing the composer\n        if (app.composer.component instanceof ReplyComposer) {\n            m.route.set(app.route.discussion(app.composer.component.props.discussion, 'reply'));\n        }\n\n        if (app.composer.component instanceof EditPostComposer) {\n            m.route.set(app.route.post(app.composer.component.props.post));\n        }\n\n        // reset the button for a new upload\n        setTimeout(() => {\n            this.$('form')[0].reset();\n            this.uploading(false);\n            m.redraw();\n        }, 1000);\n    }\n}\n","import app from 'flarum/app';\nimport {extend} from 'flarum/extend';\nimport Post from 'flarum/components/Post';\n\n/* global $ */\n\nexport default function () {\n    extend(Post.prototype, 'config', function (isInitialized) {\n        if (isInitialized) return;\n\n        this.$('[data-fof-upload-download-uuid]').unbind('click').on('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n\n            if (!app.forum.attribute('fof-upload.canDownload')) {\n                alert(app.translator.trans('fof-upload.forum.states.unauthorized'));\n                return;\n            }\n\n            let url = app.forum.attribute('apiUrl') + '/fof/download';\n\n            url += '/' + e.currentTarget.dataset.fofUploadDownloadUuid;\n            url += '/' + this.props.post.id();\n            url += '/' + app.session.csrfToken;\n\n            window.open(url);\n        });\n    });\n}\n","import app from 'flarum/app';\n\nimport downloadButtonInteraction from './downloadButtonInteraction';\nimport addUploadButton from './addUploadButton';\n\napp.initializers.add('fof-upload', () => {\n    addUploadButton();\n    downloadButtonInteraction();\n});\n","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['components/EditPostComposer'];","module.exports = flarum.core.compat['components/LoadingIndicator'];","module.exports = flarum.core.compat['components/Post'];","module.exports = flarum.core.compat['components/ReplyComposer'];","module.exports = flarum.core.compat['components/TextEditor'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['helpers/icon'];","module.exports = flarum.core.compat['utils/Stream'];"],"sourceRoot":""}